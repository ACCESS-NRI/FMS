<HTML>
<TITLE>module amip_interp</TITLE>
<BODY BGCOLOR="#AABBCC" TEXT="#332211" >

<DIV ALIGN="CENTER"> <FONT SIZE=1>
<A HREF="#INTERFACE">PUBLIC INTERFACE</A> / 
<A HREF="#DATA_TYPES">DATA</A> / 
<A HREF="#ROUTINES">ROUTINES</A> / 
<A HREF="#NAMELIST">NAMELIST</A> / 
<A HREF="#CHANGES">CHANGES</A> / 
<A HREF="#ERRORS">ERRORS</A> / 
<A HREF="#REFERENCES">REFERENCES</A> / 
<A HREF="#NOTES">NOTES</A> 
</FONT>
<BR><BR></DIV><HR>


<H2>module amip_interp</H2>
<A NAME="HEADER">
<PRE>
     <B>Contact:</B>   Bruce Wyman
     <B>Reviewers:</B>

     <B><A HREF=".doc.log#amip_interp.f90">Tags/Status</A></B>
</PRE>
</A><!-- END HEADER -->
<!--------------------------------------------------------------------->
<A NAME="OVERVIEW">
<HR>
<H4>OVERVIEW</H4>
<!-- BEGIN OVERVIEW -->
<PRE>

     Provides observed SST and ice mask data sets that have been
     interpolated onto your model's grid.

</PRE>
</A><!-- END OVERVIEW -->
<!--------------------------------------------------------------------->
<A NAME="DESCRIPTION">
<!-- BEGIN DESCRIPTION -->
<PRE>

     Three possible data sets are available:

     1)  <A HREF="http://www-pcmdi.llnl.gov/amip">AMIP 1</A>        from Jan 1979 to Jan 1989 (2 deg x 2 deg)
     2)  <A HREF="amip_interp.rey_oi.txt">Reynolds OI</A>   from Nov 1981 to Jan 1999 (1 deg x 1 deg)
     3)  <A HREF="ftp://podaac.jpl.nasa.gov/pub/sea_surface_temperature/reynolds/rsst/doc/rsst.html">Reynolds EOF</A>  from Jan 1950 to Dec 1998 (2 deg x 2 deg)

     All original data are observed monthly means. This module
     interpolates linearly in time between pairs of monthly means.
     Horizontal interpolation is done using the horiz_interp module.

     When a requested date falls outside the range of dates available
     a namelist option allows for use of the climatological monthly
     mean values which are computed from all of the data in a particular
     data set.

</PRE>
</A><!-- END DESCRIPTION -->
<!--------------------------------------------------------------------->
<A NAME="MODULES_USED">
<HR>
<H4>OTHER MODULES USED</H4>
<!-- BEGIN MODULES_USED -->
<PRE>

     time_interp_mod
    time_manager_mod
    horiz_interp_mod
       utilities_mod
       constants_mod

</PRE>
</A><!-- END MODULES_USED -->
<!--------------------------------------------------------------------->
<A NAME="INTERFACE">
<HR>
<H4>PUBLIC INTERFACE</H4>
<!-- BEGIN INTERFACE -->
<PRE>

use amip_interp_mod [, only:  amip_interp_type,
                              amip_interp_init,
                              amip_interp_end,
                              get_amip_sst, 
                              get_amip_ice, 
                              get_sst_grid_size,
                              get_sst_grid_boundary ]

  <A HREF="amip_interp.doc.html#DATA_TYPES">amip_interp_type</A>
         A variable of this defined data type is returned when function
         amip_interp_init is called.  This variable is needed when
         calling get_amip_sst and get_amip_ice.
                       
  <A HREF="amip_interp.doc.html#amip_interp_init">amip_interp_init</A>
         Function that initializes data needed for the horizontal
         interpolation between the sst grid and model grid. The 
         returned variable of type amip_interp_type is needed when
         calling get_amip_sst and get_amip_ice.

  <A HREF="amip_interp.doc.html#amip_interp_end">amip_interp_end</A>
         Call this routine for all amip_interp_type variables created by
         amip_interp_init.

  <A HREF="amip_interp.doc.html#get_amip_sst">get_amip_sst</A>
         Returns SST on the model grid for a requested time.

  <A HREF="amip_interp.doc.html#get_amip_ice">get_amip_ice</A>
         Returns an ice mask on the model grid for a requested time.

  <A HREF="amip_interp.doc.html#get_sst_grid_size">get_sst_grid_size</A>
         Returns the size (i.e., number of longitude and latitude
         points) of the observed data grid.

  <A HREF="amip_interp.doc.html#get_sst_grid_boundary">get_sst_grid_boundary</A>
         Returns the grid box boundaries of the observed data grid.

NOTES:

  1) An optional namelist interface called <b>amip_interp_nml</b> may be
     read from file <b>input.nml</b>.

  2) The observed SST data sets must be located in directory INPUT.
     <A HREF="amip_interp.doc.html#DATA_SETS">See below for details.</A>

</PRE>
</A><!-- END INTERFACE -->
<!--------------------------------------------------------------------->
<A NAME="DATA_TYPES">
<HR>
<H4>PUBLIC DATA</H4>
<!-- BEGIN DATA_TYPES -->
<PRE>

<b>type amip_interp_type</b>

  All variables in this data type are PRIVATE. It contains information
  needed by the interpolation module (exchange_mod) and buffers data.

</PRE>
</A><!-- END DATA_TYPES -->
<!--------------------------------------------------------------------->
<A NAME="ROUTINES">
<HR>
<H4>PUBLIC ROUTINES</H4>
<!-- BEGIN ROUTINES -->
<PRE>
<A NAME="amip_interp_init">

Interp = amip_interp_init ( blon, blat, mask, use_climo, use_annual )

Input

  blon   longitude in radians of the model's grid box edges
            [real, dimension(:)]

  blat   latitude in radians of the model's grid box edges
            [real, dimension(:)]

  mask   A mask for the model grid.
            [logical, dimension(:,:)]

Input (Optional)

  use_climo   Flag the specifies that monthly mean climatological
              values will be used.
                [logical; default, use_climo = .false.]

  use_annual  Flag the specifies that the annual mean climatological
              will be used.  If both use_annual = use_climo = true,
              then use_annual = true will be used.
                [logical; default, use_annual = .false.]

Returned value

  Interp    A defined data type variable needed when calling
            get_amip_sst and get_amip_ice.
                [amip_interp_type]

NOTES:

  1) This function may be called to initialize multiple variables
     of type amip_interp_type.  However, there currently is no
     call to release the storage used by this variable.

  2) The size of input augment mask must be a function of the size
     of input augments blon and blat. The first and second dimensions
     of mask must equal (size(blon)-1, size(blon)-1).

--------------------------------------------------------------------
<A NAME="amip_interp_end">

call amip_interp_end (Interp)

Input/Output

  Interp    A defined data type variable initialized by amip_interp_init
            and used when calling get_amip_sst and get_amip_ice.
                [amip_interp_type]

--------------------------------------------------------------------
<A NAME="get_amip_sst">

call get_amip_sst (Time, Interp, sst)

Input

  Time    The requested time for the output sea surface temperature field.
             [time_type] 

Input/Output

  Interp  A defined data type variable initialized by amip_interp_init.
             [amip_interp_type]

Output

  sst     The sea surface temperatures at <b>Time</b> on the model grid.
          The size of sst is the same as argument mask in amip_interp_init.
             [real, dimension(:,:)]

--------------------------------------------------------------------
<A NAME="get_amip_ice">

call get_amip_ice (Time, Interp, ice)

Input

  Time    The requested time for the output sea surface temperature field.
             [time_type]  

Input/Output                                                

  Interp  A defined data type variable initialized by amip_interp_init.
             [amip_interp_type]

Output

  ice     A real ice/no ice mask at <b>Time</b> on the model grid.
          The value of ice is continuous from 0.0 (no ice) to 1.0 (ice).
          The size of ice is the same as argument mask in amip_interp_init.
             [real, dimension(:,:)]

--------------------------------------------------------------------
<A NAME="get_sst_grid_size">

call get_sst_grid_size (nlon, nlat)

Output

  nlon  The number of longitude points (first dimension) in the
        observed data grid.  For AMIP 1 nlon = 180, and the Reynolds
        nlon = 360.    [integer]

  nlat  The number of latitude points (second dimension) in the
        observed data grid.  For AMIP 1 nlon = 91, and the Reynolds
        nlon = 180.    [integer]

--------------------------------------------------------------------
<A NAME="get_sst_grid_boundary">

call get_sst_grid_boundary (blon, blat, mask)

Output

  blon  The grid box edges (in radians) for longitude points of the
        observed data grid. The size of this argument must be nlon+1.
          [real, dimension(:)]

  blat  The grid box edges (in radians) for latitude points of the
        observed data grid. The size of this argument must be nlat+1.
          [real, dimension(:)]

</PRE>
</A><!-- END ROUTINES -->
<!--------------------------------------------------------------------->
<A NAME="NAMELIST">
<HR>
<H4>NAMELIST</H4>
<!-- BEGIN NAMELIST -->
<PRE>

<b>&amip_interp_nml</b>

  data_set   =  Name/type of SST data that will be used.
                [character(len=24), default: data_set = 'amip1']

                Possible values (case-insensitive) are: 
                           amip1
                           reynolds_eof
                           reynolds_oi
                See the <A HREF="amip_interp.doc.html#DATA_SETS">data set section</A> for more on these data.

  date_out_of_range  =  Controls the use of climatological monthly mean data when
                        the requested date falls outside the range of the data set.
                        [character(len=16), default: date_out_of_range = 'fail']

                        Possible values are:
                          fail      - program will fail if requested date is prior
                                      to or after the data set period
                          initclimo - program uses climatological requested data is
                                      prior to data set period and will fail if
                                      requested date is after data set period.
                          climo     - program uses climatological data anytime

  tice_crit  =  Freezing point of sea water in degC or degK.
                   [real, default: tice_crit = -1.80]

  verbose    =  Controls printed output, 0 &gt;= verbose &gt;= 3
                   [integer, default: verbose = 0]

  amip_date  =  Single calendar date in integer "(year,month,day)" format
                that is used only if set with year&gt;0, month&gt;0, day&gt;0. 
                If used, model calendar date is replaced by this date, 
                but model time of day is still used to determine ice/sst.
                Used for repeating-single-day experiments.
                   [integer(3), default: (/-1,-1,-1/)]

  sst_pert   =  Temperature perturbation in degrees Kelvin added onto the SST.
                The perturbation is globally-uniform (even near sea-ice).
                It is only used when abs(sst_pert) &gt; 1.e-4.  SST perturbation runs
                may be useful in accessing model sensitivities.
                   [real, default: sst_pert=0.]

  use_zonal  =  Flag to select zonal idealized sst (and ice) data
                   [logical, default: use_zonal = .false.]

---- additional parameters for controlling zonal prescribed sst ----
---- these parameters only have an effect when use_zonal=.true. ----

  teq  = sst at the equator [default: teq=305.]
  tdif = equator to pole sst difference [default: tdif=50.]
  tann = amplitude of annual cycle [default: tann=20.]
  tlag = offset for time of year (for annual cycle) [default: tlag=0.875]

</PRE>
</A><!-- END NAMELIST -->
<!--------------------------------------------------------------------->
<A NAME="DATA_SETS">
<HR>
<H4>DATA SETS</H4>
<!-- BEGIN DATA_SETS -->
<PRE>

   Valid data sets are:

     1)  <A HREF="http://www-pcmdi.llnl.gov/amip">AMIP 1</A>
             from Jan 1979 to Jan 1989 (2 deg x 2 deg)
     2)  <A HREF="amip_interp.rey_oi.txt">Reynolds OI</A>
             from Nov 1981 to Jan 1999 (1 deg x 1 deg)
             The analysis uses in situ and satellite SST's plus
             SST's simulated by sea-ice cover.
     3)  <A HREF="ftp://podaac.jpl.nasa.gov/pub/sea_surface_temperature/reynolds/rsst/doc/rsst.html">Reynolds EOF</A>
             from Jan 1950 to Dec 1998 (2 deg x 2 deg)
             <b>NCEP Reynolds Historical Reconstructed Sea Surface Temperature</b>
             The analysis uses both in-situ SSTs and satellite derived SSTs
             from the NOAA Advanced Very High Resolution Radiometer.
             In-situ data is used from 1950 to 1981, while both AVHRR derived
             satellite SSTs and in-situ data are used from 1981 to the
             end of 1998. 
   
   The data set used by this module have been reformatted as 32-bit IEEE.
   The data values are packed into 16-bit integers.

   The data sets are read from the following files:

         amip1           INPUT/amip1_sst.data
         reynolds_io     INPUT/reyoi_sst.data
         reynolds_eof    INPUT/reynolds_sst.data

</PRE>
</A><!-- END DATA_SETS -->
<!--------------------------------------------------------------------->
<A NAME="CHANGES">
<HR>
<H4>CHANGE HISTORY</H4>
<!-- BEGIN CHANGES -->
<PRE>
<B><A HREF=".doc.log#cloud_rad.f90">CVS Revision history</A></B>


<B>Changes prior to CVS version control</B>

<b>changes</b>

  * option for either AMIP 1 or Reynolds OI SSTs.
  * AMIP 1 data has been reformatted
  * namelist input has been added
  * several routine names have changed but their function has not:
       get_amip_grid_size      changed to  get_sst_grid_size
       get_amip_grid_boundary  changed to  get_sst_grid_boundary

<b>changes</b>  (11/23/1999)

    Removed optional additional grid feature.
    New version should be (nearly) identical to the pre-blue version.

<b>changes</b>  (4/28/2000)

    Interpolation is done using horiz_interp_mod (instead on exchange_mod).


</PRE>
</A><!-- END CHANGES -->
<!--------------------------------------------------------------------->
<A NAME="ERRORS">
<HR>
<H4>ERROR MESSAGES</H4>
<!-- BEGIN ERRORS -->
<PRE>

<b>FATAL ERRORS in amip_interp_init</b>

   <b>obsolete namelist option USE_AMIP1 should be replaced by option DATA_SET - check documentation</b>
      Use namelist variable DATA_SET instead of USE_AMIP1.

   <b>obsolete namelist option USE_NO_CLIMO should be replaced by option DATE_OUT_OF_RANGE - check documentation</b>
      Use namelist variable DATE_OUT_OF_RANGE instead of USE_NO_CLIMO.

   <b>the value of the namelist parameter DATA_SET being used is not allowed</b>
      Check the value of namelist variable DATA_SET.

   <b>requested input data set does not exist</b>
      The data set requested is valid but the data does not exist in
      the INPUT subdirectory. You may have requested amip2 data which
      has not been officially set up.
      See the section on DATA SETS to properly set the data up.

   <b>use_climo mismatch</b>
      The namelist variable date_out_of_range = 'fail' and
      the amip_interp_init argument use_climo = true.
      This combination is not allowed.

   <b>use_annual(climo) mismatch</b>
      The namelist variable date_out_of_range = 'fail' and
      the amip_interp_init argument use_annual = true.
      This combination is not allowed.

<b>FATAL ERRORS in get_sst_grid_size</b>

   <b>have not called amip_interp_init</b>
      Must call amip_interp_init before get_sst_grid_size.

<b>FATAL ERRORS in get_sst_grid_boundary</b>

   <b>have not called amip_interp_init</b>
      Must call amip_interp_init before get_sst_grid_boundary.

   <b>invalid argument dimensions</b>
      The size of the output argument arrays do not agree with
      the size of the observed data. See the documentation for
      interfaces get_sst_grid_size and get_sst_grid_boundary.

<b>FATAL ERRORS in read_record</b>

   <b>climo data read when NO climo data requested</b>
      Data for the requested date could not be found and climatological
      data was read, however the namelist variable date_out_of_range will
      not allow the use of climatological data. Your integration may
      be before or after the valid dates of the data set you are using.
      If this is your intended purpose you can modify namelist
      variable date_out_of_range, see the <A HREF="amip_interp.doc.html#NAMELIST">namelist documentation</A>.

   <b>end of file reading unit ##</b>
      The end of the data set was reached before finding the
      requested date.  CHECK WITH THE DEVELOPER.

</PRE>
</A><!-- END ERRORS -->
<!--------------------------------------------------------------------->
<A NAME="REFERENCES">
<HR>
<H4>REFERENCES</H4>
<!-- BEGIN REFERENCES -->
<PRE>

     None.

</PRE>
</A><!-- END REFERENCES -->
<!--------------------------------------------------------------------->
<A NAME="BUGS">
<HR>
<H4>KNOWN BUGS</H4>
<!-- BEGIN BUGS -->
<PRE>

     There are no known bugs at this time.

</PRE>
</A><!-- END BUGS -->
<!--------------------------------------------------------------------->
<A NAME="NOTES">
<HR>
<H4>NOTES</H4>
<!-- BEGIN NOTES -->
<PRE>

     None.

</PRE>
</A><!-- END NOTES -->
<!--------------------------------------------------------------------->
<A NAME="PLANS">
<HR>
<H4>FUTURE PLANS</H4>
<!-- BEGIN PLANS -->
<PRE>

     * Add AMIP 2 data set

     * Other data sets (or extend current data sets) ?

</PRE>
</A><!-- END PLANS -->
<!--------------------------------------------------------------------->

<HR>
</BODY>
</HTML>
