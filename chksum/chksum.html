<html>
<head>
<title>chksum_mod: a checksum module for f90</title>
</head>
<body>
<center><h1>chksum_mod</h1>
<h3>a checksum module for f90</h3>
</center>
<blockquote>
<hr>
<b><tt>chksum_mod</tt></b> is a set of overloaded functions returning
checksums of integer and floating point arrays.<hr>
</blockquote>

<p>
<br><a href="#introduction">Introduction to <b><tt>chksum_mod</tt></b>.</a>
<br><a href="#using">Using <b><tt>chksum_mod</tt></b>.</a>
<br><a href="#source">Acquiring <b><tt>chksum_mod</tt></b> source.</a>
<br><a href="#linking">Linking with <b><tt>chksum_mod</tt></b>.</a>
<br><a href="#portability">Portability issues.</a>
<hr>
<ol>
<p><a name="introduction"><li><h4>Introduction</h4>

<p>Checksums are required for testing code that is in constant
flux. These reduce arrays to a single number that will show whether
modifications to code have changed answers.

<p>This is particularly critical in floating-point codes. Simply
summing arrays may not show changes to small numbers. The f90
intrinsic <b><tt>epsilon()</tt></b> is the smallest floating point
number that can be added to 1 and show a change: i.e
<tt>1.+epsilon(1.)</tt> is different from <tt>1.</tt> in the last bit;
where as <tt>1.+0.5*epsilon(1.)</tt> is <i>identical</i> to
<tt>1.</tt> in FP arithmetic. (<b><tt>epsilon</tt></b> is of the order
<b><tt>10^-16</tt></b> for 8-byte reals).

<p>Integer arithmetic however exactly recovers changes to every bit.

<p><b><tt>chksum_mod</tt></b> uses <i>Cray pointers</i> to treat FP
arrays as though they were integers (an operation that is otherwise
forbidden in the F90 standard). Cray pointers, while not in the
official F90 standard, is a <i>de facto</i> standard, available on
most compilers used in technical and scientific computing.

<p>This module provides checksums for serial code. Parallel checksums,
that will provide identical answers no matter how the same array is
partitioned across processors, are provided by <a
href="mpp.html#mpp_chksum"><b><tt>mpp_mod</tt></b></a>.

<p><a name="using"><li><h4>Using <b><tt>chksum_mod</tt></b></h4>

<p><b><tt>chksum_mod</tt></b> provides a single public interface, the
integer function <b><tt>chksum(var)</tt></b>. <b><tt>var</tt></b> can
be an integer, real, or complex scalar or array of rank up to 4. For
example:

<p><pre>
real :: var(:,:,:,:)
i = chksum(var)
</pre>

<p>returns the checksum of the array <b><tt>var</tt></b> in
<b><tt>i</tt></b>.

<p><a name="source"><li><h4>Acquiring chksum_mod source</h4>

<p>GFDL users can copy the file
<b><tt>/net/vb/public/utils/chksum.F90</tt></b>. External users can
download the source <a
href="ftp://ftp.gfdl.gov/pub/vb/utils/chksum.F90">here</a>. The
current public version number is 1.1.

<p><a name="linking"><li><h4>Compiling and linking to chksum_mod</h4>

<p>Any module or program unit using <b><tt>chksum_mod</tt></b> must contain the
line

<pre>
   use chksum_mod
</pre>

<p>Compiling <b><tt>chksum_mod</tt></b> requires cpp macro expansion on
every line of code, not just those beginning with #. Turning this on
usually requires a compiler flag (e.g <b><tt>-F</tt></b> on Cray
systems and <b><tt>-macro_expand</tt></b> on SGI MipsPro). Please
consult your compiler manual for this flag.

<p>The source file for <b><tt>chksum_mod</tt></b> is <a
href="ftp://ftp.gfdl.gov/pub/vb/utils/chksum.F90"><b><tt>chksum.F90</tt></b></a>.

<p>Compiling with the cpp flag <b><tt>test_chksum</tt></b> turned on:

<p><pre>
f90 -F -Dtest_chksum chksum.F90
</pre>

<p>will produce a program that will exercise the
<b><tt>chksum_mod</tt></b> module.

<p><a name="portability"><li><h4>Portability issues</h4>

<b><tt>chksum_mod</tt></b> requires the use of Cray pointers in order
to treat floating point arguments. If your compiler supports Cray
pointers, add it to the list in the preamble that defines
<b><tt>use_CRI_pointers</tt></b>, or else turn on the cpp flag
<b><tt>-Duse_CRI_pointers</tt></b> by hand.

<p>If your compiler does not support Cray pointers, you are restricted
to integer arguments.

<p>On non-SGI/Cray systems, you may also wish to examine carefully the
definition of the various <b><tt>_KIND</tt></b> macros defined in the
preamble.

<p><a name="Changes"></a><li><h4>Changes</h4>

The <a href="changes_chksum.html">RCS log</a> for
<b><tt>chksum.F90</tt></b> contains a comprehensive list of changes. In the
unlikely event that you should wish to check out a retro version,
please get in touch with me, <a href="myaddr.html">Balaji</a>.
</ol>

<p><hr><small>Document last modified
   <!--#exec cmd="echo $LAST_MODIFIED" --></small>
   <!--#exec cmd="echo $DOCUMENT_NAME $REMOTE_IDENT@$REMOTE_HOST $HTTP_REFERER $DATE_LOCAL >> stats" -->
</body>
</html>
